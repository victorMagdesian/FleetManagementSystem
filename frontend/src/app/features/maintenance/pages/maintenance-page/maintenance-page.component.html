<div class="maintenance-page">
  <div class="page-header">
    <h1>Manutenções</h1>
    <button 
      pButton 
      label="Nova Manutenção" 
      icon="pi pi-plus" 
      (click)="openCreateDialog()">
    </button>
  </div>

  <p-tabView>
    <p-tabPanel header="Todas">
      <p-table 
        [value]="allMaintenance" 
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} manutenções"
        styleClass="p-datatable-striped">
        
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="vehicleId">
              Veículo <p-sortIcon field="vehicleId"></p-sortIcon>
            </th>
            <th pSortableColumn="date">
              Data <p-sortIcon field="date"></p-sortIcon>
            </th>
            <th pSortableColumn="description">
              Descrição <p-sortIcon field="description"></p-sortIcon>
            </th>
            <th pSortableColumn="cost">
              Custo <p-sortIcon field="cost"></p-sortIcon>
            </th>
            <th>Ações</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-maintenance>
          <tr>
            <td>
              <a 
                href="javascript:void(0)" 
                class="vehicle-link"
                (click)="openVehicleHistory(maintenance.vehicleId)">
                {{ maintenance.vehicleId }}
              </a>
            </td>
            <td>{{ maintenance.date | dateFormat:'dd/MM/yyyy' }}</td>
            <td>{{ maintenance.description }}</td>
            <td>{{ maintenance.cost | currencyFormat }}</td>
            <td>
              <button 
                pButton 
                icon="pi pi-history" 
                class="p-button-rounded p-button-text p-button-sm"
                pTooltip="Ver Histórico"
                (click)="openVehicleHistory(maintenance.vehicleId)">
              </button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center">
              <div class="empty-message">
                <i class="pi pi-wrench"></i>
                <p>Nenhuma manutenção encontrada</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>

    <p-tabPanel header="Próximas">
      <p-table 
        [value]="upcomingVehicles" 
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} veículos"
        styleClass="p-datatable-striped">
        
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="plate">
              Placa <p-sortIcon field="plate"></p-sortIcon>
            </th>
            <th pSortableColumn="model">
              Modelo <p-sortIcon field="model"></p-sortIcon>
            </th>
            <th pSortableColumn="nextMaintenanceDate">
              Próxima Manutenção <p-sortIcon field="nextMaintenanceDate"></p-sortIcon>
            </th>
            <th>Ações</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-vehicle>
          <tr>
            <td><strong>{{ vehicle.plate }}</strong></td>
            <td>{{ vehicle.model }}</td>
            <td>
              <span class="upcoming-date">
                {{ vehicle.nextMaintenanceDate | dateFormat:'dd/MM/yyyy' }}
              </span>
            </td>
            <td>
              <button 
                pButton 
                icon="pi pi-history" 
                class="p-button-rounded p-button-text p-button-sm"
                pTooltip="Ver Histórico"
                (click)="openVehicleHistory(vehicle.id)">
              </button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="4" class="text-center">
              <div class="empty-message">
                <i class="pi pi-check-circle"></i>
                <p>Nenhuma manutenção próxima nos próximos 7 dias</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>
  </p-tabView>
</div>

<app-maintenance-form
  [visible]="showFormDialog"
  (onClose)="onFormClose()"
  (onSuccess)="onFormSuccess()">
</app-maintenance-form>

<app-maintenance-history
  [visible]="showHistoryDialog"
  [vehicleId]="selectedVehicleId"
  (onClose)="onHistoryClose()">
</app-maintenance-history>
