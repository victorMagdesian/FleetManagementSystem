<div class="vehicles-page">
  <div class="page-header">
    <h1>Veículos</h1>
    <button 
      pButton 
      label="Novo Veículo" 
      icon="pi pi-plus" 
      (click)="openCreateDialog()">
    </button>
  </div>

  <div class="search-bar">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input 
        pInputText 
        type="text" 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        placeholder="Buscar por placa ou modelo" />
    </span>
  </div>

  <p-table 
    [value]="filteredVehicles" 
    [loading]="loading"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} veículos"
    styleClass="p-datatable-striped">
    
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="plate">
          Placa <p-sortIcon field="plate"></p-sortIcon>
        </th>
        <th pSortableColumn="model">
          Modelo <p-sortIcon field="model"></p-sortIcon>
        </th>
        <th pSortableColumn="year">
          Ano <p-sortIcon field="year"></p-sortIcon>
        </th>
        <th pSortableColumn="mileage">
          Quilometragem <p-sortIcon field="mileage"></p-sortIcon>
        </th>
        <th pSortableColumn="lastMaintenanceDate">
          Última Manutenção <p-sortIcon field="lastMaintenanceDate"></p-sortIcon>
        </th>
        <th pSortableColumn="nextMaintenanceDate">
          Próxima Manutenção <p-sortIcon field="nextMaintenanceDate"></p-sortIcon>
        </th>
        <th pSortableColumn="status">
          Status <p-sortIcon field="status"></p-sortIcon>
        </th>
        <th>Ações</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-vehicle>
      <tr>
        <td><strong>{{ vehicle.plate }}</strong></td>
        <td>{{ vehicle.model }}</td>
        <td>{{ vehicle.year }}</td>
        <td>{{ vehicle.mileage | number:'1.0-0' }} km</td>
        <td>{{ vehicle.lastMaintenanceDate | dateFormat:'dd/MM/yyyy' }}</td>
        <td>{{ vehicle.nextMaintenanceDate | dateFormat:'dd/MM/yyyy' }}</td>
        <td>
          <app-status-badge [status]="vehicle.status"></app-status-badge>
        </td>
        <td>
          <div class="action-buttons">
            <button 
              pButton 
              icon="pi pi-pencil" 
              class="p-button-rounded p-button-text p-button-sm"
              pTooltip="Editar"
              (click)="openEditDialog(vehicle)">
            </button>
            <button 
              pButton 
              icon="pi pi-trash" 
              class="p-button-rounded p-button-text p-button-danger p-button-sm"
              pTooltip="Excluir"
              (click)="confirmDelete(vehicle)">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center">
          <div class="empty-message">
            <i class="pi pi-car"></i>
            <p>Nenhum veículo encontrado</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<app-vehicle-form
  [visible]="showFormDialog"
  [vehicle]="selectedVehicle"
  (onClose)="onFormClose()"
  (onSuccess)="onFormSuccess()">
</app-vehicle-form>
